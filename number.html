<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>多位数学习系统</title>
    <style>
      :root {
        --main-color: #2563eb;
        --success-color: #4caf50;
        --danger-color: #f44336;
        --warning-color: #ffd700;
      }

      * {
        touch-action: manipulation;
      }

      body {
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
        margin: 0;
        padding: 15px 0;
        background-color: #f0f9ff;
        font-family: "Arial Rounded", Arial, sans-serif;
        box-sizing: border-box;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        user-select: none;
      }

      .title {
        font-size: 1.5rem;
        color: var(--main-color);
        margin-bottom: 15px;
        text-align: center;
        padding: 0 10px;
      }

      .digits-container {
        display: flex;
        gap: 1px;
        margin: 15px 0;
        width: 100%;
        padding: 0;
        box-sizing: border-box;
        justify-content: space-between;
      }

      .digit-group {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        min-width: 0;
        transition: transform 0.2s;
        padding: 0 1px;
      }

      .digit-group:hover {
        transform: scale(1.05);
      }

      .number {
        font-size: 2.8rem;
        color: var(--main-color);
        margin: 2px 0;
        text-align: center;
        min-width: 35px;
        transition: all 0.3s;
        user-select: none;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
      }

      .number.changed {
        animation: numberChange 0.5s;
      }

      @keyframes numberChange {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.2);
        }
        100% {
          transform: scale(1);
        }
      }

      .button {
        padding: 8px 6px;
        font-size: 1.2rem;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        margin: 1px 0;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        box-sizing: border-box;
        transition: all 0.2s;
        white-space: nowrap;
        user-select: none;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
      }

      .digit-button {
        width: 100%;
        max-width: 45px;
      }

      .action-button {
        width: 100%;
        max-width: 120px;
      }

      .button:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      }

      .button:active {
        transform: translateY(0);
      }

      .increment {
        background-color: var(--success-color);
        color: white;
      }
      .decrement {
        background-color: var(--danger-color);
        color: white;
      }
      .reset {
        background-color: var(--warning-color);
        color: #333;
      }

      .button-container {
        display: flex;
        gap: 10px;
        margin: 15px 0;
        justify-content: center;
        width: 100%;
        max-width: 300px;
        padding: 0 10px;
      }

      .digit-label {
        font-size: 0.9rem;
        color: #666;
        margin-bottom: 2px;
      }

      .total-number {
        display: inline-flex;
        align-items: stretch;
        font-size: 1.4rem;
        color: var(--main-color);
        margin: 15px 0;
        border-radius: 6px;
        overflow: hidden;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        height: 45px;
        user-select: none;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
      }

      .total-label {
        background-color: var(--main-color);
        color: white;
        padding: 0 12px;
        font-weight: bold;
        display: flex;
        align-items: center;
        user-select: none;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
      }

      .total-value {
        background-color: white;
        padding: 0 15px;
        min-width: 60px;
        display: flex;
        align-items: center;
        justify-content: center;
        user-select: none;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
      }

      @media (min-width: 480px) {
        body {
          padding: 15px 0;
        }
        .digits-container {
          gap: 2px;
          padding: 0 5px;
        }
        .digit-group {
          padding: 0 3px;
        }
        .button-container {
          max-width: 400px;
          gap: 15px;
        }
        .number {
          font-size: 3.5rem;
        }
        .button {
          font-size: 1.4rem;
          padding: 10px 8px;
        }
        .digit-button {
          max-width: 55px;
        }
        .digit-label {
          font-size: 1rem;
        }
      }

      @media (min-width: 768px) {
        body {
          padding: 20px 0;
        }
        .digits-container {
          gap: 3px;
          padding: 0 10px;
        }
        .digit-group {
          padding: 0 5px;
        }
        .button-container {
          max-width: 500px;
          gap: 20px;
        }
        .number {
          font-size: 4.5rem;
        }
        .button {
          font-size: 1.6rem;
          padding: 12px 10px;
        }
        .digit-button {
          max-width: 65px;
        }
        .digit-label {
          font-size: 1.1rem;
        }
      }
    </style>
  </head>
  <body>
    <h1 class="title">一起来玩数字游戏吧！</h1>

    <div class="digits-container">
      <!-- 万位 -->
      <div class="digit-group">
        <div class="digit-label">万位</div>
        <button
          class="button increment digit-button"
          onclick="changeDigit(4, 1)"
        >
          +
        </button>
        <div class="number" id="tenThousandsDigit">0</div>
        <button
          class="button decrement digit-button"
          onclick="changeDigit(4, -1)"
        >
          -
        </button>
      </div>

      <!-- 千位 -->
      <div class="digit-group">
        <div class="digit-label">千位</div>
        <button
          class="button increment digit-button"
          onclick="changeDigit(3, 1)"
        >
          +
        </button>
        <div class="number" id="thousandsDigit">0</div>
        <button
          class="button decrement digit-button"
          onclick="changeDigit(3, -1)"
        >
          -
        </button>
      </div>

      <!-- 百位 -->
      <div class="digit-group">
        <div class="digit-label">百位</div>
        <button
          class="button increment digit-button"
          onclick="changeDigit(2, 1)"
        >
          +
        </button>
        <div class="number" id="hundredsDigit">0</div>
        <button
          class="button decrement digit-button"
          onclick="changeDigit(2, -1)"
        >
          -
        </button>
      </div>

      <!-- 十位 -->
      <div class="digit-group">
        <div class="digit-label">十位</div>
        <button
          class="button increment digit-button"
          onclick="changeDigit(1, 1)"
        >
          +
        </button>
        <div class="number" id="tensDigit">0</div>
        <button
          class="button decrement digit-button"
          onclick="changeDigit(1, -1)"
        >
          -
        </button>
      </div>

      <!-- 个位 -->
      <div class="digit-group">
        <div class="digit-label">个位</div>
        <button
          class="button increment digit-button"
          onclick="changeDigit(0, 1)"
        >
          +
        </button>
        <div class="number" id="unitsDigit">0</div>
        <button
          class="button decrement digit-button"
          onclick="changeDigit(0, -1)"
        >
          -
        </button>
      </div>
    </div>

    <div class="total-number">
      <span class="total-label">当前数字</span>
      <span class="total-value" id="totalNumber">0</span>
    </div>

    <div class="button-container">
      <button class="button reset action-button" onclick="resetAll()">
        重置归零
      </button>
      <button class="button increment action-button" onclick="randomNumber()">
        随机数字
      </button>
    </div>

    <script>
      let digits = [0, 0, 0, 0, 0];
      let speechSynthesis = window.speechSynthesis;
      let speaking = false;
      let speakTimeout = null;
      let firstLoad = true;

      function speakWelcome() {
        if (speaking) {
          speechSynthesis.cancel();
        }
        const utterance = new SpeechSynthesisUtterance("一起来玩数字游戏吧");
        utterance.lang = "zh-CN";
        utterance.rate = 0.9;
        utterance.pitch = 1;
        speaking = true;
        utterance.onend = () => {
          speaking = false;
        };
        speechSynthesis.speak(utterance);
      }

      // 将数字转换为中文读法
      function numberToChinese(num) {
        const units = ["", "十", "百", "千", "万"];
        const digits = [
          "零",
          "一",
          "二",
          "三",
          "四",
          "五",
          "六",
          "七",
          "八",
          "九",
        ];

        if (num === 0) return "零";

        let result = "";
        let unitIndex = 0;

        while (num > 0) {
          const digit = num % 10;
          if (digit !== 0) {
            result = digits[digit] + units[unitIndex] + result;
          } else if (result && result[0] !== "零") {
            result = "零" + result;
          }
          num = Math.floor(num / 10);
          unitIndex++;
        }

        // 处理特殊情况
        result = result.replace(/零+$/, "");
        result = result.replace(/^一十/, "十");

        return result;
      }

      function speakNumber(num) {
        // 清除之前的定时器
        if (speakTimeout) {
          clearTimeout(speakTimeout);
        }

        // 停止当前正在播放的语音
        if (speaking) {
          speechSynthesis.cancel();
        }

        // 设置新的定时器，延迟300ms后播放
        speakTimeout = setTimeout(() => {
          const text = numberToChinese(num);
          const utterance = new SpeechSynthesisUtterance(text);
          utterance.lang = "zh-CN";
          utterance.rate = 0.8;
          utterance.pitch = 1;

          speaking = true;
          utterance.onend = () => {
            speaking = false;
          };

          speechSynthesis.speak(utterance);
        }, 300);
      }

      function changeDigit(position, delta) {
        digits[position] += delta;

        // 进位/借位处理
        for (let i = position; i < digits.length; i++) {
          while (digits[i] > 9) {
            if (i < digits.length - 1) {
              digits[i + 1]++;
              digits[i] -= 10;
            } else {
              digits[i] = 9;
            }
          }
          while (digits[i] < 0) {
            if (i < digits.length - 1) {
              digits[i + 1]--;
              digits[i] += 10;
            } else {
              digits[i] = 0;
            }
          }
        }

        updateDisplay();
      }

      function updateDisplay() {
        const elements = {
          unitsDigit: 0,
          tensDigit: 1,
          hundredsDigit: 2,
          thousandsDigit: 3,
          tenThousandsDigit: 4,
        };

        for (const [id, index] of Object.entries(elements)) {
          const element = document.getElementById(id);
          const oldValue = parseInt(element.textContent);
          const newValue = digits[index];

          if (oldValue !== newValue) {
            element.textContent = newValue;
            element.classList.add("changed");
            setTimeout(() => element.classList.remove("changed"), 500);
          }
        }

        // 更新总数
        const total = digits.reduce(
          (acc, val, idx) => acc + val * Math.pow(10, idx),
          0
        );
        document.getElementById("totalNumber").textContent = total;

        // 首次加载时不朗读数字
        if (firstLoad) {
          firstLoad = false;
          return;
        }
        // 朗读数字
        speakNumber(total);
      }

      function resetAll() {
        digits = [0, 0, 0, 0, 0];
        updateDisplay();
      }

      function randomNumber() {
        const max = 99999;
        const randomNum = Math.floor(Math.random() * max);
        const numStr = randomNum.toString().padStart(5, "0");
        digits = numStr.split("").map(Number).reverse();
        updateDisplay();
      }

      // 初始化显示
      window.addEventListener("DOMContentLoaded", () => {
        updateDisplay();
        speakWelcome();
      });
    </script>
  </body>
</html>
